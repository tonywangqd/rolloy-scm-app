# 补货行动中心 - 使用指南

## 概述

补货行动中心是库存预测系统的核心功能，为采购团队提供基于库存预测的智能补货建议。

## 功能特性

### 1. 智能优先级排序
系统根据以下因素自动计算优先级：
- **紧急 (Critical)**: 已断货或即将断货
- **高 (High)**: 风险库存，需要尽快补货
- **中 (Medium)**: 安全库存偏低
- **低 (Low)**: 预防性补货

### 2. 多维度筛选
- 优先级筛选: 快速定位不同紧急程度的补货需求
- 超期筛选: 一键显示已超过下单截止日期的建议
- SKU 搜索: 支持按 SKU 或产品名称搜索

### 3. 实时统计
- 总计: 当前所有补货建议数量
- 紧急: 需要立即处理的建议数量
- 高优先级: 高优先级建议数量
- 已超期: 超过下单截止日期的数量
- 平均剩余: 平均距离下单截止日期的天数

### 4. 一键操作
- **创建采购单**: 自动跳转到采购单创建页面，预填充 SKU、数量和截止日期
- **查看详情**: 跳转到库存预测图表，查看该 SKU 的 12 周库存趋势

## 使用流程

### 场景 1: 每日采购计划审核

1. 打开"库存预测"页面 (`/planning/projection`)
2. 查看补货行动中心的统计数据
3. 点击"紧急"或"已超期"快速筛选高优先级建议
4. 逐条审核建议，点击"创建采购单"
5. 在采购单页面调整数量、选择供应商
6. 确认并提交采购单

### 场景 2: 特定 SKU 补货检查

1. 在 SKU 搜索框输入 SKU 或产品名
2. 查看该 SKU 的补货建议
3. 点击"查看详情"查看库存预测趋势
4. 根据趋势图判断是否需要调整建议数量
5. 返回补货行动中心，创建采购单

### 场景 3: 周度补货计划

1. 使用优先级筛选，先处理"紧急"和"高"优先级
2. 查看"平均剩余天数"，评估整体库存健康度
3. 分批次创建采购单:
   - 第一批: 紧急 + 已超期
   - 第二批: 高优先级
   - 第三批: 中优先级 (根据预算和供应商产能)

## 界面说明

### 筛选控件区域
```
┌─────────────────────────────────────────┐
│ 优先级筛选                              │
│ [全部] [紧急] [高] [中] [低]           │
│                                         │
│ 快速筛选        搜索 SKU / 产品名      │
│ [仅显示超期]    [__________________]   │
└─────────────────────────────────────────┘
```

### 统计卡片区域
```
┌──────┐ ┌───────────┐ ┌────────────┐ ┌──────────┐ ┌──────────┐
│总计: │ │紧急: 5    │ │高优先级: 8 │ │已超期: 3 │ │平均剩余: │
│  25  │ │           │ │            │ │          │ │   12天   │
└──────┘ └───────────┘ └────────────┘ └──────────┘ └──────────┘
        (可点击)       (可点击)         (可点击)
```

### 数据表格
```
┌─────────────┬──────────┬──────────┬────────────┬────────┬────────┬────────────────┐
│ SKU / 产品  │ 风险周   │ 建议采购 │ 下单截止   │ 优先级 │ 库存   │ 操作           │
├─────────────┼──────────┼──────────┼────────────┼────────┼────────┼────────────────┤
│ SKU-001     │ 2025-W07 │   500    │ 2025-02-01 │ 紧急   │ 断货   │ [创建采购单]   │
│ Product A   │(02/10-16)│   件     │ (3天内)    │        │        │ [查看详情]     │
├─────────────┼──────────┼──────────┼────────────┼────────┼────────┼────────────────┤
│ SKU-002     │ 2025-W08 │   300    │ 2025-02-05 │ 高     │ 风险   │ [创建采购单]   │
│ Product B   │(02/17-23)│   件     │ (7天内)    │        │        │ [查看详情]     │
└─────────────┴──────────┴──────────┴────────────┴────────┴────────┴────────────────┘
```

## 数据说明

### 建议采购数量计算逻辑
```
建议采购数量 = 安全库存 - 预计期末库存 + 预计销量
```

### 下单截止日期计算
```
下单截止日期 = 风险周开始日期 - 供应商交期 - 物流时间
```

### 优先级判定规则
- **紧急**: 库存状态为"断货"
- **高**: 库存状态为"风险" 且剩余天数 ≤ 7 天
- **中**: 库存状态为"风险" 且剩余天数 > 7 天
- **低**: 库存状态为"正常" 但需要预防性补货

## 最佳实践

### 1. 每日检查
- 每天上午检查"紧急"和"已超期"建议
- 立即处理超期建议，避免缺货

### 2. 数量调整考虑因素
- **供应商 MOQ**: 调整到最小起订量的整数倍
- **包装规格**: 按箱数或托盘数调整
- **运输成本**: 考虑满载优化
- **促销计划**: 如有促销，适当增加订货量

### 3. 批量操作策略
- 同一供应商的多个 SKU 可以合并为一张采购单
- 考虑供应商产能和我方预算，分批下单

### 4. 异常处理
如果建议数量明显不合理：
1. 点击"查看详情"查看库存预测图表
2. 检查销量预测是否异常
3. 检查在途订单是否已录入系统
4. 联系计划团队确认数据准确性

## 技术细节

### 数据来源
补货建议来自数据库视图 `v_replenishment_suggestions`，该视图基于：
- 12 周库存预测 (`v_inventory_projection_12weeks`)
- 产品主数据 (`products`)
- 安全库存设置
- 供应商交期配置

### 刷新机制
- 页面加载时自动获取最新数据
- 点击刷新按钮重新加载数据
- 建议每天早上和下午各刷新一次

### 性能优化
- 所有筛选和排序在客户端完成，响应迅速
- 使用 React 性能优化 (useMemo, useCallback)
- 支持处理 1000+ 条建议记录

## 常见问题

### Q1: 为什么某些 SKU 没有显示补货建议？
**A**: 可能的原因：
- 库存预测显示未来 12 周均正常，无需补货
- 该 SKU 未配置安全库存
- 已有足够的在途订单

### Q2: 建议数量可以修改吗？
**A**: 可以。点击"创建采购单"后，在采购单页面可以调整数量。

### Q3: 如果错过了下单截止日期怎么办？
**A**: 系统会将该建议标记为"已超期"，并以红色高亮显示。建议立即处理，必要时联系供应商申请加急生产。

### Q4: 如何忽略某些不需要的建议？
**A**: 目前版本暂不支持忽略功能。如果确认不需要补货，可以直接跳过该建议，或联系系统管理员更新安全库存配置。

### Q5: 为什么"平均剩余天数"会是负数？
**A**: 负数表示平均已超期的天数，说明有多个建议已超过下单截止日期，需要紧急处理。

## 相关文档

- [库存预测说明](./INVENTORY_PROJECTION_GUIDE.md)
- [采购订单管理](./PURCHASE_ORDER_GUIDE.md)
- [安全库存配置](./SAFETY_STOCK_CONFIG.md)

## 技术支持

如有任何问题或建议，请联系：
- 系统管理员: admin@rolloy.com
- 技术支持: support@rolloy.com

---

**最后更新**: 2025-11-30
**版本**: 1.0.0
