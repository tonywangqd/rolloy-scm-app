# 销量时间线功能 - 测试指南

## 前置条件

确保数据库已包含以下数据：
1. ✅ `weekly_sales_forecasts` 表有预测数据（2025-W13 到 2026-W13）
2. ✅ `weekly_sales_actuals` 表有实际数据（截止到 2025-W48）
3. ✅ `products` 表有活跃产品数据

## 快速测试步骤

### 1. 启动开发服务器

```bash
cd /Users/tony/Desktop/rolloy-scm
npm run dev
```

### 2. 访问页面

在浏览器中打开：
```
http://localhost:3000/planning
```

### 3. 验证功能

#### 3.1 页面加载检查
- [ ] 页面正常加载，无错误
- [ ] 统计卡片显示正确
- [ ] 时间线图表显示在统计卡片下方

#### 3.2 时间线图表检查
- [ ] 显示标题"销量时间线"
- [ ] 显示描述"过去4周实际销量 + 当前周 + 未来12周预测销量"
- [ ] 显示图例（过去周/当前周/未来周）
- [ ] 柱状图正常渲染
- [ ] X轴显示周标签（W45, W46, W47...）
- [ ] Y轴显示销量数值

#### 3.3 颜色编码检查
- [ ] 过去周的柱状图为绿色
- [ ] 当前周的柱状图为琥珀色/黄色
- [ ] 未来周的柱状图为蓝色
- [ ] 当前周有虚线参考线标记

#### 3.4 交互功能检查
- [ ] 鼠标悬停显示 Tooltip
- [ ] Tooltip 显示完整周号（如 2025-W49）
- [ ] 过去周 Tooltip 显示：实际销量、预测销量、偏差、偏差率
- [ ] 当前周 Tooltip 显示：预测销量（和可能的当前销量）
- [ ] 未来周 Tooltip 显示：预测销量

#### 3.5 汇总统计检查
- [ ] 显示"过去4周总实际"（绿色数字）
- [ ] 显示"当前周预测"（琥珀色数字）
- [ ] 显示"未来12周预测"（蓝色数字）
- [ ] 数值格式化正确（千位分隔符）

#### 3.6 响应式检查
- [ ] 图表在不同屏幕尺寸下自适应
- [ ] 移动端视图正常显示
- [ ] 柱状图宽度合理

### 4. 边界情况测试

#### 4.1 空数据测试
如果数据库为空：
```sql
-- 临时清空测试（谨慎操作）
DELETE FROM weekly_sales_forecasts WHERE year_week BETWEEN '2025-W45' AND '2025-W61';
DELETE FROM weekly_sales_actuals WHERE year_week BETWEEN '2025-W45' AND '2025-W61';
```

预期结果：
- [ ] 显示"暂无数据"提示
- [ ] 无报错或崩溃

#### 4.2 部分数据测试
仅有预测无实际：
- [ ] 过去周显示为0或空柱
- [ ] Tooltip 显示预测为0的提示

仅有实际无预测：
- [ ] 未来周显示为0或空柱
- [ ] Tooltip 显示预测为0的提示

#### 4.3 跨年测试
如果当前时间在年末或年初：
- [ ] ISO周格式正确处理跨年
- [ ] 周顺序正确（2025-W52 → 2026-W01）

### 5. 性能测试

#### 5.1 加载时间
- [ ] 页面首次加载时间 < 3秒
- [ ] 图表渲染时间 < 1秒
- [ ] 无明显卡顿

#### 5.2 数据量测试
增加数据量（多SKU、多渠道）：
- [ ] 查询响应时间合理
- [ ] 图表渲染流畅
- [ ] 内存使用正常

### 6. 浏览器兼容性

测试浏览器：
- [ ] Chrome (最新版本)
- [ ] Firefox (最新版本)
- [ ] Safari (最新版本)
- [ ] Edge (最新版本)

### 7. TypeScript 类型检查

```bash
npx tsc --noEmit
```

预期结果：
- [ ] 无 TypeScript 错误
- [ ] 无类型警告

### 8. 构建测试

```bash
npm run build
```

预期结果：
- [ ] 构建成功
- [ ] 无编译错误
- [ ] 页面路由包含在构建输出中

## 测试数据示例

### 创建测试数据（如需要）

```sql
-- 插入测试预测数据（过去4周+当前周+未来12周）
INSERT INTO weekly_sales_forecasts (year_week, sku, channel_code, forecast_qty)
VALUES
  ('2025-W45', 'TEST-SKU-001', 'CH-US-01', 100),
  ('2025-W46', 'TEST-SKU-001', 'CH-US-01', 120),
  ('2025-W47', 'TEST-SKU-001', 'CH-US-01', 150),
  ('2025-W48', 'TEST-SKU-001', 'CH-US-01', 140),
  ('2025-W49', 'TEST-SKU-001', 'CH-US-01', 160),
  ('2025-W50', 'TEST-SKU-001', 'CH-US-01', 180),
  -- ... 继续添加到 W61
;

-- 插入测试实际数据（仅过去周）
INSERT INTO weekly_sales_actuals (year_week, sku, channel_code, actual_qty)
VALUES
  ('2025-W45', 'TEST-SKU-001', 'CH-US-01', 95),
  ('2025-W46', 'TEST-SKU-001', 'CH-US-01', 125),
  ('2025-W47', 'TEST-SKU-001', 'CH-US-01', 148),
  ('2025-W48', 'TEST-SKU-001', 'CH-US-01', 145)
;
```

## 已知问题记录

### 问题追踪
在测试过程中发现的问题记录在此：

| 问题ID | 描述 | 优先级 | 状态 |
|--------|------|--------|------|
| - | - | - | - |

## 测试完成检查清单

完成所有测试后，确认以下内容：

- [ ] 所有功能检查项通过
- [ ] 所有边界情况测试通过
- [ ] 性能表现良好
- [ ] 浏览器兼容性良好
- [ ] TypeScript 检查通过
- [ ] 构建测试通过
- [ ] 无严重 Bug
- [ ] 文档齐全

## 反馈和改进

### 用户体验反馈
记录用户使用反馈：
- 视觉体验
- 交互体验
- 数据准确性
- 功能建议

### 性能优化建议
- 查询优化
- 渲染优化
- 缓存策略

### 功能扩展建议
- SKU筛选
- 渠道分析
- 自定义时间范围
- 数据导出

## 测试报告模板

```
测试日期：____________________
测试人员：____________________
测试环境：____________________

功能测试：✅ / ❌
性能测试：✅ / ❌
兼容性测试：✅ / ❌
边界测试：✅ / ❌

发现问题数：______ 个
严重问题：______ 个
一般问题：______ 个

总体评价：____________________
建议：____________________
```

## 联系方式

如遇到问题或需要支持，请联系：
- 技术支持：[您的联系方式]
- 文档反馈：[反馈渠道]
