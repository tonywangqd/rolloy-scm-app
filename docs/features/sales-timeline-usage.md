# 销量时间线功能使用指南

## 功能位置

销量时间线图表位于**计划管理页面**（`/planning`），在统计卡片下方。

## 功能说明

### 时间范围
- **过去4周**：显示已发生的实际销量
- **当前周**：本周预测（可能包含部分实际数据）
- **未来12周**：未来销量预测
- **总计**：17周连续数据

### 颜色编码
- **绿色柱**：过去周的实际销量（已完成）
- **琥珀色柱**：当前周（进行中）
- **蓝色柱**：未来周的预测销量（计划中）

### 交互功能

#### 1. Tooltip 悬停提示
将鼠标悬停在任意柱状图上，会显示详细信息：

**过去周显示：**
- 实际销量
- 预测销量
- 偏差（实际 - 预测）
- 偏差率（百分比）

**当前周显示：**
- 预测销量
- 当前销量（如有）

**未来周显示：**
- 预测销量

#### 2. 汇总统计
图表底部显示三个关键指标：
- **过去4周总实际**：历史销量总和
- **当前周预测**：本周计划销量
- **未来12周预测**：未来销量总和

### 数据聚合
- 时间线显示的是**所有SKU和渠道的汇总数据**
- 如需查看单个SKU的数据，请参考下方的"周度汇总"表格

## 使用场景

### 1. 销量趋势分析
快速了解过去销量表现和未来销量预期，识别销量高峰和低谷。

### 2. 预测准确性评估
通过对比过去周的实际销量和预测销量，评估预测模型的准确性。

### 3. 计划调整依据
根据历史偏差情况，调整未来周的预测值，提高计划准确性。

### 4. 资源规划
基于未来12周的预测总量，合理安排采购、仓储、物流等资源。

## 数据更新

### 自动更新
- 页面设置为动态渲染（`force-dynamic`）
- 每次访问页面都会从数据库获取最新数据
- 当前周会自动根据系统日期计算

### 数据来源
- **预测数据**：来自 `weekly_sales_forecasts` 表
- **实际数据**：来自 `weekly_sales_actuals` 表
- **更新方式**：
  - 预测：通过"管理预测"页面更新
  - 实际：通过"录入实际"页面更新

## 最佳实践

### 1. 定期录入实际销量
建议每周结束后及时录入实际销量，以便：
- 及时发现预测偏差
- 调整后续周的预测
- 保持时间线的完整性

### 2. 关注偏差率
- 偏差率 > +20%：可能预测过低，需增加后续预测
- 偏差率 < -20%：可能预测过高，需调整预测策略

### 3. 结合汇总表格使用
- 时间线提供宏观视图
- 周度汇总表提供细节数据
- 两者结合使用效果最佳

## 常见问题

### Q: 为什么某些周没有数据？
A: 可能原因：
- 尚未录入该周的预测或实际数据
- 该周的数据为0（未销售）
- 解决方法：前往"管理预测"或"录入实际"页面补充数据

### Q: 当前周显示的是预测还是实际？
A: 当前周默认显示预测值（琥珀色柱）。如果已录入部分实际销量，Tooltip中会同时显示两者。

### Q: 如何查看单个SKU的时间线？
A: 当前版本显示所有SKU的汇总数据。未来版本将支持SKU筛选功能。

### Q: 时间线的周范围能否调整？
A: 当前固定为"过去4周 + 当前周 + 未来12周"。未来版本将支持自定义范围。

## 相关页面

- **管理预测** (`/planning/forecasts`)：录入和修改预测数据
- **录入实际** (`/planning/actuals`)：录入实际销量数据
- **库存预测** (`/planning/projection`)：基于销量预测的库存规划

## 技术支持

如遇到问题或有功能建议，请联系系统管理员。
