# 发运单创建页面 - 新增仓库功能

## 修改文件
`src/app/logistics/new/page.tsx`

## 功能说明
在发运单创建页面的"目的仓库"选择器旁边添加了"新增仓库"按钮,用户可以直接在创建发运单时快速添加新的仓库,无需跳转到设置页面。

## 实现的功能

###  1. 新增状态管理
在组件中添加了以下状态:
- `showWarehouseDialog`: 控制新增仓库对话框的显示
- `creatingWarehouse`: 创建仓库的加载状态
- `warehouseError`: 创建仓库时的错误信息
- `newWarehouse`: 新仓库表单数据(代码、名称、类型、区域)

### 2. 核心功能函数

#### `refreshWarehouses()`
- 刷新仓库列表
- 从 Supabase 获取最新的活跃仓库
- 按仓库代码排序

#### `handleCreateWarehouse()`
- 验证表单数据(仓库代码、名称、类型、区域都必填)
- 调用 `createWarehouse` Server Action 创建仓库
- 创建成功后:
  - 刷新仓库列表
  - 自动查找新创建的仓库并选中
  - 自动设置仓库类型筛选
  - 关闭对话框并重置表单

### 3. UI 组件

#### 新增按钮
在"目的仓库"标签旁添加了一个"+ 新增仓库"按钮:
- 使用 `variant="ghost"` 样式
- 小尺寸 (`size="sm"`)
- Plus 图标
- 点击打开新增仓库对话框

#### 新增仓库对话框 (Dialog)
完整的表单对话框,包含:
- **仓库代码**: 文本输入,必填,带示例 placeholder
- **仓库名称**: 文本输入,必填,带示例 placeholder
- **仓库类型**: 下拉选择 (FBA仓/海外仓3PL),必填
- **区域**: 下拉选择 (East/Central/West),必填
- **错误提示**: 显示验证或创建失败的错误信息
- **操作按钮**:
  - 取消:关闭对话框
  - 创建仓库:提交表单(创建中显示加载状态)

### 4. 验证逻辑
创建仓库前会进行以下验证:
1. 仓库代码和名称不能为空
2. 必须选择仓库类型
3. 必须选择区域
4. 创建的仓库默认 `is_active = true`

### 5. 用户体验优化
- 创建成功后自动选中新仓库
- 自动设置仓库类型筛选匹配新仓库
- 创建过程中禁用表单输入
- 按钮显示加载状态("创建中...")
- 创建成功后自动关闭对话框
- 创建失败显示具体错误信息

## 修改的导入
添加了以下导入:
- `Dialog`, `DialogContent`, `DialogDescription`, `DialogFooter`, `DialogHeader`, `DialogTitle` from `@/components/ui/dialog`
- `createWarehouse` from `@/lib/actions/settings`
- `Plus` icon from `lucide-react`

## 代码位置
- **状态定义**: 第 115-124 行
- **刷新函数**: 第 270-279 行
- **创建函数**: 第 281-337 行
- **UI 按钮**: 第 938-942 行
- **对话框组件**: 第 1193-1278 行

## 测试建议
1. 点击"新增仓库"按钮,验证对话框打开
2. 不填写必填项,验证错误提示
3. 填写完整信息,创建仓库
4. 验证仓库创建成功并自动选中
5. 验证仓库列表已更新
6. 验证仓库类型筛选器已自动设置

## 已知限制
- 仓库代码的唯一性验证由后端 Server Action 处理
- 如果代码重复,会显示后端返回的错误信息
